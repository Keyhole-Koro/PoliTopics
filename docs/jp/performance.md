# バックエンド API レイテンシ比較

[English Version](../../docs/performance.md)

**AWS Lambda** と **Cloudflare Workers** で実行されているバックエンド API のレイテンシ測定結果。

> **測定スクリプト:** `PoliTopicsWeb/bench/measure-backend-latency.js`
> このスクリプトは各バックエンドエンドポイントを繰り返し呼び出し、レイテンシ統計 (min / avg / p50 / p95 / p99) を記録します。

---

## コールドスタートレイテンシ (AWS Lambda)

一定期間非アクティブだった後に関数を呼び出すことで測定。

| エンドポイント | 平均 (ms) | p50 (ms) | p95 (ms) | 最大 (ms) |
| -------------- | --------: | -------: | -------: | --------: |
| `/headlines`   |   6228.89 |  6285.55 |  6314.38 |   6314.38 |
| `/article`     |   6432.02 |  6319.97 |  6702.59 |   6702.59 |
| `/suggest`     |   4985.03 |  5809.22 |  6133.70 |   6133.70 |

> Cloudflare Workers は、Isolate ベースの実行モデルにより、測定可能なコールドスタートレイテンシを示しません。

---

## ウォームスタートレイテンシ (平均 / p95)

### `/headlines`

| プラットフォーム   |  平均 (ms) |   p95 (ms) |
| ------------------ | ---------: | ---------: |
| AWS Lambda         |      454.6 |    1496.98 |
| Cloudflare Workers | **234.79** | **567.15** |

---

### `/article`

| プラットフォーム   |  平均 (ms) |   p95 (ms) |
| ------------------ | ---------: | ---------: |
| AWS Lambda         |     763.87 |    1446.46 |
| Cloudflare Workers | **377.91** | **554.54** |

---

### `/suggest`

| プラットフォーム   | 平均 (ms) |   p95 (ms) |
| ------------------ | --------: | ---------: |
| AWS Lambda         |    296.75 |     630.88 |
| Cloudflare Workers | **85.88** | **211.02** |

---

## 全体比較

### コールドスタート vs ウォームスタート (平均)

| エンドポイント | Lambda コールドスタート | Lambda ウォームスタート | Workers ウォームスタート |
| -------------- | ----------------------: | ----------------------: | -----------------------: |
| `/headlines`   |                  ~6.2 s |                454.6 ms |            **234.79 ms** |
| `/article`     |                  ~6.4 s |               763.87 ms |            **377.91 ms** |
| `/suggest`     |                  ~5.0 s |               296.75 ms |             **85.88 ms** |

---

## 重要なポイント

- AWS Lambda のコールドスタートは **約 5〜6.7 秒** のレイテンシを追加する。
- コールドスタートがなくても、Cloudflare Workers は平均して **1.9倍〜3.5倍高速** である。
- テイルレイテンシ (p95) は Workers の方が一貫して低い。
- レイテンシに敏感なユーザー向け API にとって、**Cloudflare Workers は明確な利点を提供する**。
